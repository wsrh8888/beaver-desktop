# Beaver IM MCPå·¥å…·è§„åˆ’ - åŸºäºçœŸå®ä»£ç åˆ†æ

## é¡¹ç›®çœŸå®æƒ…å†µåˆ†æ

ç»è¿‡æ·±å…¥ä»£ç åˆ†æï¼Œè¿™æ˜¯ä¸€ä¸ª**éå¸¸æˆç†Ÿçš„å¼€æºIMé¡¹ç›®**ï¼Œå…·å¤‡ï¼š

### ğŸ—ï¸ æ¶æ„æˆç†Ÿåº¦
- **å¤šè¿›ç¨‹æ¶æ„**ï¼šä¸»è¿›ç¨‹(ä¸šåŠ¡) + æ¸²æŸ“è¿›ç¨‹(UI) + é¢„åŠ è½½è¿›ç¨‹
- **9ä¸ªç‹¬ç«‹çª—å£**ï¼šä¸»èŠå¤©ã€ç™»å½•ã€å›¾ç‰‡æŸ¥çœ‹ã€éŸ³é¢‘æ’­æ”¾ã€è§†é¢‘æ’­æ”¾ã€æœ‹å‹åœˆã€æœç´¢ã€éªŒè¯ã€æ›´æ–°
- **å®Œæ•´çš„æ•°æ®å±‚**ï¼šSQLiteæ•°æ®åº“ + æ•°æ®åŒæ­¥æœåŠ¡
- **æˆç†Ÿçš„ä¸šåŠ¡é€»è¾‘**ï¼šæ¶ˆæ¯ã€å¥½å‹ã€ç¾¤èŠã€è¡¨æƒ…åŒ…ã€é€šçŸ¥ç­‰å®Œæ•´å®ç°

### ğŸ’ª åŠŸèƒ½å®Œæ•´æ€§
- **æ¶ˆæ¯ç³»ç»Ÿ**ï¼šæ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€è¯­éŸ³ç­‰æ¶ˆæ¯ç±»å‹
- **ç¤¾äº¤å…³ç³»**ï¼šå¥½å‹ç®¡ç†ã€ç¾¤èŠã€å¥½å‹éªŒè¯
- **å¤šåª’ä½“**ï¼šå›¾ç‰‡é¢„è§ˆã€éŸ³é¢‘æ’­æ”¾ã€è§†é¢‘æ’­æ”¾ã€æ–‡ä»¶ä¼ è¾“
- **æ•°æ®åŒæ­¥**ï¼šå¤šç«¯æ•°æ®åŒæ­¥ã€ç¦»çº¿æ¶ˆæ¯ã€çŠ¶æ€åŒæ­¥
- **ç”¨æˆ·ä½“éªŒ**ï¼šä¸°å¯Œçš„è¡¨æƒ…åŒ…ã€æœ‹å‹åœˆã€æœç´¢åŠŸèƒ½

### ğŸ”§ æŠ€æœ¯æ ˆ
- **å‰ç«¯**ï¼šVue3 + TypeScript + Less + Pinia
- **åç«¯**ï¼šNode.js + Electron + SQLite + Drizzle ORM
- **é€šä¿¡**ï¼šWebSocket + IPC + HTTP API
- **æ„å»º**ï¼šVite + Electron Builder

## åŸºäºçœŸå®èƒ½åŠ›çš„MCPå·¥å…·è§„åˆ’

### 1. æ¶ˆæ¯æ“ä½œæ¨¡å— (Messaging) â­â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šé¡¹ç›®å·²æœ‰çš„æ¶ˆæ¯å‘é€ã€å†å²æŸ¥è¯¢ç­‰åŠŸèƒ½

**æ¨èå·¥å…·**ï¼š
- `send_text_message` âœ… - åˆ©ç”¨ç°æœ‰çš„æ¶ˆæ¯å‘é€API
- `send_image_message` - æ‰©å±•å›¾ç‰‡æ¶ˆæ¯å‘é€
- `send_file_message` - æ‰©å±•æ–‡ä»¶æ¶ˆæ¯å‘é€
- `get_message_history` - åˆ©ç”¨ç°æœ‰çš„å†å²æŸ¥è¯¢
- `search_messages` - æ‰©å±•æ¶ˆæ¯æœç´¢åŠŸèƒ½
- `delete_message` - æ¶ˆæ¯åˆ é™¤åŠŸèƒ½
- `forward_message` - æ¶ˆæ¯è½¬å‘

### 2. å¥½å‹ç®¡ç†æ¨¡å— (Friend) â­â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šå®Œæ•´çš„FriendBusinesså’Œæ•°æ®åº“æœåŠ¡

**æ¨èå·¥å…·**ï¼š
- `get_friends_list` âœ… - åˆ©ç”¨ç°æœ‰çš„å¥½å‹åˆ—è¡¨æŸ¥è¯¢
- `add_friend` - ä½¿ç”¨ç°æœ‰çš„å¥½å‹éªŒè¯æµç¨‹
- `remove_friend` - åˆ é™¤å¥½å‹å…³ç³»
- `block_friend` - æ‹‰é»‘å¥½å‹
- `search_users` - åˆ©ç”¨ç°æœ‰çš„ç”¨æˆ·æœç´¢

### 3. ç¾¤èŠç®¡ç†æ¨¡å— (Group) â­â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šå®Œæ•´çš„GroupBusinesså’Œç¾¤èŠåŠŸèƒ½

**æ¨èå·¥å…·**ï¼š
- `get_groups_list` âœ… - åˆ©ç”¨ç°æœ‰çš„ç¾¤èŠåˆ—è¡¨æŸ¥è¯¢
- `create_group` - ä½¿ç”¨ç°æœ‰çš„åˆ›å»ºç¾¤èŠåŠŸèƒ½
- `join_group` - åŠ å…¥ç¾¤èŠ
- `leave_group` - é€€å‡ºç¾¤èŠ
- `invite_to_group` - é‚€è¯·æˆå‘˜
- `remove_group_member` - ç§»é™¤æˆå‘˜
- `set_group_admin` - è®¾ç½®ç®¡ç†å‘˜

### 4. æœç´¢åŠŸèƒ½æ¨¡å— (Search) â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šé¡¹ç›®æœ‰ç‹¬ç«‹çš„æœç´¢çª—å£å’Œæœç´¢API

**æ¨èå·¥å…·**ï¼š
- `search_contacts` âœ… - åˆ©ç”¨ç°æœ‰çš„è”ç³»äººæœç´¢
- `search_messages` - æ‰©å±•æ¶ˆæ¯å†…å®¹æœç´¢
- `global_search` - å…¨å±€æœç´¢ï¼ˆè”ç³»äºº+æ¶ˆæ¯+ç¾¤èŠï¼‰

### 5. é€šçŸ¥ç®¡ç†æ¨¡å— (Notification) â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šå®Œæ•´çš„é€šçŸ¥ç³»ç»Ÿå’ŒNotificationBusiness

**æ¨èå·¥å…·**ï¼š
- `get_notifications` - è·å–é€šçŸ¥åˆ—è¡¨
- `mark_notification_read` - æ ‡è®°å·²è¯»
- `send_notification` - å‘é€ç³»ç»Ÿé€šçŸ¥
- `clear_notifications` - æ¸…é™¤é€šçŸ¥

### 6. åª’ä½“å¤„ç†æ¨¡å— (Media) â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šé¡¹ç›®æœ‰image/audio/videoä¸‰ä¸ªç‹¬ç«‹çª—å£

**æ¨èå·¥å…·**ï¼š
- `download_media` - æ–‡ä»¶ä¸‹è½½åŠŸèƒ½
- `upload_media` - æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- `view_image` - åˆ©ç”¨å›¾ç‰‡æŸ¥çœ‹çª—å£
- `play_audio` - åˆ©ç”¨éŸ³é¢‘æ’­æ”¾çª—å£
- `play_video` - åˆ©ç”¨è§†é¢‘æ’­æ”¾çª—å£

### 7. è¡¨æƒ…åŒ…ç®¡ç†æ¨¡å— (Emoji) â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šå®Œæ•´çš„EmojiBusinesså’Œè¡¨æƒ…åŒ…ç³»ç»Ÿ

**æ¨èå·¥å…·**ï¼š
- `get_emoji_packages` - è·å–è¡¨æƒ…åŒ…åˆ—è¡¨
- `add_emoji` - æ·»åŠ è¡¨æƒ…åˆ°æ”¶è—
- `remove_emoji` - ç§»é™¤æ”¶è—è¡¨æƒ…
- `search_emoji` - æœç´¢è¡¨æƒ…

### 8. æœ‹å‹åœˆæ¨¡å— (Moment) â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šç‹¬ç«‹çš„æœ‹å‹åœˆçª—å£å’ŒMomentBusiness

**æ¨èå·¥å…·**ï¼š
- `get_moments` - è·å–æœ‹å‹åœˆåŠ¨æ€
- `create_moment` - å‘å¸ƒæœ‹å‹åœˆ
- `like_moment` - ç‚¹èµåŠ¨æ€
- `comment_moment` - è¯„è®ºåŠ¨æ€

### 9. DOMæ“ä½œæ¨¡å— (DOM) â­â­â­â­â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šElectronåº”ç”¨å¤©ç„¶å…·å¤‡DOMæ“ä½œèƒ½åŠ›

**æ¨èå·¥å…·**ï¼š
- `dom_query_selector` - æŸ¥è¯¢DOMå…ƒç´ 
- `dom_click_element` - ç‚¹å‡»å…ƒç´ 
- `dom_input_text` - è¾“å…¥æ–‡æœ¬
- `dom_scroll_element` - æ»šåŠ¨é¡µé¢
- `dom_get_element_info` - è·å–å…ƒç´ ä¿¡æ¯
- `dom_take_screenshot` - æˆªå–å±å¹•
- `dom_wait_for_element` - ç­‰å¾…å…ƒç´ åŠ è½½
- `dom_get_page_content` - è·å–é¡µé¢å†…å®¹

### 10. ç³»ç»Ÿæ§åˆ¶æ¨¡å— (System) â­
**åŸºäºç°æœ‰èƒ½åŠ›**ï¼šåº”ç”¨è®¾ç½®ã€ç”¨æˆ·çŠ¶æ€ç­‰

**æ¨èå·¥å…·**ï¼š
- `logout` âœ… - é€€å‡ºç™»å½•
- `get_system_info` - ç³»ç»Ÿä¿¡æ¯
- `set_user_status` - è®¾ç½®ç”¨æˆ·çŠ¶æ€
- `update_app` - æ£€æŸ¥æ›´æ–°

## å®é™…å¯è¡Œæ€§è¯„ä¼°

### âœ… é«˜å¯è¡Œæ€§ (ç°æœ‰APIç›´æ¥å¯ç”¨)
1. **æ¶ˆæ¯æ“ä½œ** - MessageBusinessæœ‰å®Œæ•´API
2. **å¥½å‹ç®¡ç†** - FriendBusinessæœ‰å®Œæ•´å®ç°
3. **ç¾¤èŠç®¡ç†** - GroupBusinessåŠŸèƒ½å®Œå–„
4. **æœç´¢åŠŸèƒ½** - æœ‰ç‹¬ç«‹çš„æœç´¢çª—å£å’ŒAPI

### âš ï¸ ä¸­ç­‰å¯è¡Œæ€§ (éœ€è¦æ‰©å±•ç°æœ‰åŠŸèƒ½)
5. **é€šçŸ¥ç®¡ç†** - é€šçŸ¥ç³»ç»Ÿå­˜åœ¨ï¼Œéœ€è¦å°è£…MCPæ¥å£
6. **åª’ä½“å¤„ç†** - æœ‰åª’ä½“çª—å£ï¼Œéœ€è¦å°è£…æ“ä½œæ¥å£
7. **è¡¨æƒ…åŒ…ç®¡ç†** - EmojiBusinesså®Œæ•´ï¼Œéœ€è¦MCPæ¥å£
8. **æœ‹å‹åœˆ** - MomentåŠŸèƒ½å®Œæ•´ï¼Œéœ€è¦MCPæ¥å£

### ğŸš€ é«˜ä»·å€¼ (å€¼å¾—é‡ç‚¹å¼€å‘)
9. **DOMæ“ä½œ** - è¿™æ˜¯æ‚¨çš„æ ¸å¿ƒéœ€æ±‚ï¼ŒElectronåº”ç”¨å¤©ç„¶æ”¯æŒ
10. **ç³»ç»Ÿæ§åˆ¶** - åº”ç”¨æ§åˆ¶åŠŸèƒ½

## æ¨èå¼€å‘é¡ºåº

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ (1-2å‘¨)
1. **å®Œå–„æ¶ˆæ¯æ“ä½œæ¨¡å—** - åŸºäºç°æœ‰MessageBusiness
2. **å®Œå–„å¥½å‹ç®¡ç†æ¨¡å—** - åŸºäºç°æœ‰FriendBusiness
3. **å®Œå–„ç¾¤èŠç®¡ç†æ¨¡å—** - åŸºäºç°æœ‰GroupBusiness

### Phase 2: æ‰©å±•åŠŸèƒ½ (2-3å‘¨)
4. **DOMæ“ä½œæ¨¡å—** - é‡ç‚¹å¼€å‘ï¼Œæ»¡è¶³æ‚¨çš„æ ¸å¿ƒéœ€æ±‚
5. **æœç´¢åŠŸèƒ½æ¨¡å—** - æ•´åˆç°æœ‰æœç´¢èƒ½åŠ›
6. **é€šçŸ¥ç®¡ç†æ¨¡å—** - å°è£…é€šçŸ¥åŠŸèƒ½

### Phase 3: é«˜çº§åŠŸèƒ½ (1-2å‘¨)
7. **åª’ä½“å¤„ç†æ¨¡å—** - æ•´åˆå¤šåª’ä½“çª—å£
8. **è¡¨æƒ…åŒ…å’Œæœ‹å‹åœˆæ¨¡å—** - é”¦ä¸Šæ·»èŠ±

## æŠ€æœ¯å®ç°å»ºè®®

### DOMæ“ä½œæ¨¡å—å…·ä½“å®ç°
ç”±äºæ‚¨çš„æ ¸å¿ƒéœ€æ±‚æ˜¯DOMæ“ä½œï¼Œå»ºè®®è¿™æ ·å®ç°ï¼š

```typescript
// åˆ©ç”¨Electronçš„webContents API
import { BrowserWindow } from 'electron'

export const domQuerySelector = {
  name: 'dom_query_selector',
  inputSchema: z.object({
    windowType: z.enum(['main', 'image', 'audio', 'video']).describe('çª—å£ç±»å‹'),
    selector: z.string().describe('CSSé€‰æ‹©å™¨'),
    timeout: z.number().optional().default(5000).describe('è¶…æ—¶æ—¶é—´(æ¯«ç§’)')
  }),
  handler: async (params) => {
    const window = getWindowByType(params.windowType)
    const result = await window.webContents.executeJavaScript(`
      (() => {
        const element = document.querySelector('${params.selector}');
        return element ? {
          tagName: element.tagName,
          className: element.className,
          id: element.id,
          textContent: element.textContent?.substring(0, 100),
          innerHTML: element.innerHTML?.substring(0, 100)
        } : null;
      })()
    `)
    return result
  }
}
```

è¿™ä¸ªè§„åˆ’æ˜¯åŸºäºæ‚¨é¡¹ç›®çš„**çœŸå®ä»£ç ç»“æ„**å’Œ**ç°æœ‰åŠŸèƒ½**åˆ¶å®šçš„ï¼Œå®Œå…¨å¯è¡Œã€‚
